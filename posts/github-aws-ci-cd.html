<!DOCTYPE html><html lang="ko-KR"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta property="og:url" content="https://100paperkite.github.io"/><meta property="og:type" content="website"/><meta property="og:locale" content="ko-KR"/><meta property="og:site_name" content="paperkite.log ğŸ‘‹"/><title>[GitHub Actions, AWSë¡œ CI/CD êµ¬ì¶•í•˜ê¸°] - 1. GitHub Actions êµ¬ì„±í•˜ê¸° | paperkite.log ğŸ‘‹</title><meta name="robots" content="index,follow"/><meta name="description" content="[GitHub Actions, AWSë¡œ CI/CD êµ¬ì¶•í•˜ê¸°] - 1. GitHub Actions êµ¬ì„±í•˜ê¸°"/><meta property="og:title" content="[GitHub Actions, AWSë¡œ CI/CD êµ¬ì¶•í•˜ê¸°] - 1. GitHub Actions êµ¬ì„±í•˜ê¸° | paperkite.log ğŸ‘‹"/><meta property="og:description" content="[GitHub Actions, AWSë¡œ CI/CD êµ¬ì¶•í•˜ê¸°] - 1. GitHub Actions êµ¬ì„±í•˜ê¸°"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","datePublished":"2023-03-03T09:41:29.368Z","description":"[GitHub Actions, AWSë¡œ CI/CD êµ¬ì¶•í•˜ê¸°] - 1. GitHub Actions êµ¬ì„±í•˜ê¸°","mainEntityOfPage":{"@type":"WebPage","@id":"https://100paperkite.github.io/posts/github-aws-ci-cd"},"headline":"[GitHub Actions, AWSë¡œ CI/CD êµ¬ì¶•í•˜ê¸°] - 1. GitHub Actions êµ¬ì„±í•˜ê¸°","dateModified":"2023-03-03T09:41:29.368Z","author":{"@type":"Person","name":"100paperkite"}}</script><meta name="next-head-count" content="12"/><script id="gtag-init" strategy="afterInteractive">
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'G-FFSLQ27YMJ', {
                page_path: window.location.pathname,
              });
            </script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-FFSLQ27YMJ"></script><link rel="preload" href="/_next/static/css/a1fed7b6ed75c1ba.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a1fed7b6ed75c1ba.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-2b9c97c898ba3e9b.js" defer=""></script><script src="/_next/static/chunks/framework-a070cbfff3c750c5.js" defer=""></script><script src="/_next/static/chunks/main-1b1db7be3343898e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c1e739f18573092f.js" defer=""></script><script src="/_next/static/chunks/1bfc9850-6dd5619a8decfbcd.js" defer=""></script><script src="/_next/static/chunks/0c428ae2-aee1a03cbb0f41ac.js" defer=""></script><script src="/_next/static/chunks/17007de1-711cf284c97b49d4.js" defer=""></script><script src="/_next/static/chunks/5386-42957cb47b98ece3.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-e8ce3b8529fbe652.js" defer=""></script><script src="/_next/static/0xQjpLb5yay7gfVz4gblO/_buildManifest.js" defer=""></script><script src="/_next/static/0xQjpLb5yay7gfVz4gblO/_ssgManifest.js" defer=""></script><script src="/_next/static/0xQjpLb5yay7gfVz4gblO/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="flex flex-col min-h-screen"><nav class="flex justify-between sticky top-0 z-50 space-x-4 py-2 font-medium mx-2 md:mx-6 my-1 md:my-2 p-2"><a class="text-neutral-800 hover:text-neutral-600 text-lg md:text-xl" href="/">paperkite.log ğŸ‘‹</a><div class="flex gap-x-3"><a href="/tags"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 640 512" class="hover:cursor-pointer w-6 h-6 text-neutral-700" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M497.941 225.941L286.059 14.059A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v204.118a48 48 0 0 0 14.059 33.941l211.882 211.882c18.744 18.745 49.136 18.746 67.882 0l204.118-204.118c18.745-18.745 18.745-49.137 0-67.882zM112 160c-26.51 0-48-21.49-48-48s21.49-48 48-48 48 21.49 48 48-21.49 48-48 48zm513.941 133.823L421.823 497.941c-18.745 18.745-49.137 18.745-67.882 0l-.36-.36L527.64 323.522c16.999-16.999 26.36-39.6 26.36-63.64s-9.362-46.641-26.36-63.64L331.397 0h48.721a48 48 0 0 1 33.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137 0 67.882z"></path></svg></a></div></nav><main class="max-w-screen-md px-4 w-full mx-auto flex-grow font-body"><div class="px-2 md:px-4 py-2 md:py-4"><div class="border-b border-1 mb-4 sm:mb-6 border-dashed border-neutral-300"><div class="flex items-center my-1 md:my-2 gap-x-2"><button class="text-neutral-500 font-bold">#ci/cd</button><button class="text-neutral-500 font-bold">#aws</button><button class="text-neutral-500 font-bold">#github</button></div><h1 class="text-3xl sm:text-4xl font-bold mb-2 sm:mb-4 mt-6 sm:mt-10">[GitHub Actions, AWSë¡œ CI/CD êµ¬ì¶•í•˜ê¸°] - 1. GitHub Actions êµ¬ì„±í•˜ê¸°</h1><div class="flex py-2 md:py-3 pl-1 text-neutral-500"><small class="">March 3, 2023<!-- -->ì— ì‘ì„±</small></div></div><article class="max-w-none prose prose-neutral sm:prose-h1:text-[2.5rem] sm:prose-h2:text-[2rem] sm:prose-h3:text-2xl sm:prose-h4:text-xl"><h2>Overview</h2>
<p><img src="/github-aws-ci-cd-0.png" alt=""/></p>
<p>ì„œë²„ ë°°í¬ëŠ” ë‹¤ìŒ ê³¼ì •ì„ ê±°ì³ ì´ë£¨ì–´ì§„ë‹¤.</p>
<ol>
<li>ë ˆí¬ì§€í† ë¦¬ì˜ <code>main</code> ë¸Œëœì¹˜ì— í‘¸ì‹œí•˜ë©´ GitHub Actionì´ ì‹¤í–‰</li>
<li>GitHub Actions ì‹¤í–‰<!-- -->
<ol>
<li>ì„œë²„ë¥¼ ë¹Œë“œ</li>
<li>OpenID Connectë¡œ AWS ì¸ì¦</li>
<li>ë¹Œë“œëœ íŒŒì¼ì„ AWS S3ì— ì—…ë¡œë“œ</li>
<li>ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ AWS CodeDeployë¥¼ ì‹¤í–‰</li>
</ol>
</li>
<li>AWS CodeDeployê°€ S3ì— ì—…ë¡œë“œëœ zip íŒŒì¼ì„ ë¯¸ë¦¬ ì •ì˜í•´ë‘” EC2 ì¸ìŠ¤í„´ìŠ¤ì— ì—…ë¡œë“œ</li>
<li>CodeDeployê°€ ì†ŒìŠ¤ì˜ ì„¤ì •íŒŒì¼(appspec.yml)ì— ë”°ë¼ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ì„œë²„ë¥¼ EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‹¤í–‰ì‹œí‚´</li>
</ol>
<h2>GitHub Actions</h2>
<p>GitHub ActionsëŠ” ê¹ƒ ë ˆí¬ì§€í† ë¦¬ì— <code>.github/workflow</code> ë””ë ‰í„°ë¦¬ë¥¼ ë§Œë“¤ê³  <code>yaml</code> í™•ì¥ì íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤. <code>main</code> ë¸Œëœì¹˜ì— í‘¸ì‹œë˜ë©´ ìë™ìœ¼ë¡œ ì„œë²„ë¥¼ ë¹Œë“œí•´ì„œ AWS EC2ì— ë°°í¬í•˜ëŠ” ë‹¤ìŒ íŒŒì¼ì„ ë³´ë©´ì„œ ê³¼ì •ì„ ì‚´í´ë³´ì.</p>
<h3><code>yaml</code> íŒŒì¼</h3>
<pre style="display:block;overflow-x:auto;background:#2d2d2d;color:#cccccc;padding:0.5em"><code class="language-yaml"># [1]
name: build and deploy a spring boot server application

# [2]
on:
  push:
    branches:
      - main

# [3]
env:
  applicationfolder: backend/gfi
  AWS_REGION: # AWS ë¦¬ì „. ex. ap-north-east-2
  S3_BUCKET: # ë¹Œë“œ íŒŒì¼ì„ ì—…ë¡œë“œí•  S3 ë²„í‚· ì´ë¦„
  CODE_DEPLOY_APP_NAME: # CodeDeployì— ì„¤ì •í•œ ì•± ì´ë¦„
  CODE_DEPLOY_GROUP_NAME: # CodeDeployì— ì„¤ì •í•œ ê·¸ë£¹ ì´ë¦„

#[4]
jobs:
  # [5]
  build:
    name: Build and Package
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ${{ env.applicationfolder }}

    # OIDCì— ì“°ì´ëŠ” ID í† í° ë°œê¸‰ì„ ìœ„í•´ ì •ì˜
    permissions:
      id-token: write
      contents: read

    steps:
	  # [5-1]
      - uses: actions/checkout@v3

	  # [5-2]
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: &#x27;17&#x27;
          distribution: &#x27;temurin&#x27;

	  # [5-3]
      - name: Grant execute permission to gradlew
        run: chmod +x ./gradlew
        shell: bash

	  # [5-4]
      - name: Execute Gradle build
        run: ./gradlew build

	  # [5-5] OIDC
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          role-to-assume: ${{ secrets.AWS_ROLE_TO_ASSUME }}
          aws-region: ${{ env.AWS_REGION }}

	  # [5-6]
      - name: Create a .env file
        run: |
          echo &quot;PORT=${{ vars.SERVER_PORT }}&quot; &gt;&gt; .env

	  # [5-7]
      - name: Make zip file
        run: zip -r $GITHUB_SHA.zip ./
        shell: bash

      - name: Upload Artifact to s3
        run: aws s3 cp $GITHUB_SHA.zip s3://${{ env.S3_BUCKET }}/

  # [6]
  deploy:
    needs: build
    runs-on: ubuntu-latest

    # OIDCì— ì“°ì´ëŠ” ID í† í° ë°œê¸‰ì„ ìœ„í•´ ì •ì˜
    permissions:
      id-token: write
      contents: read

    steps:
      - uses: actions/checkout@v2

      - uses: aws-actions/configure-aws-credentials@v1
        with:
          role-to-assume: ${{ secrets.AWS_ROLE_TO_ASSUME }}
          aws-region: ${{ env.AWS_REGION }}
      - run: |
          aws deploy create-deployment \
            --application-name ${{ env.CODE_DEPLOY_APP_NAME }} \
            --deployment-group-name ${{ env.CODE_DEPLOY_GROUP_NAME }} \
            --s3-location bucket=${{ env.S3_BUCKET }},bundleType=zip,key=$GITHUB_SHA.zip</code></pre>
<h3>[1] name</h3>
<p>ì‹¤í–‰ë  GitHub Actionsì˜ ì´ë¦„ì„ ì •ì˜í•œë‹¤.</p>
<h3>[2] on</h3>
<p><code>main</code> ë¸Œëœì¹˜ì— í‘¸ì‹œëœ ê²½ìš°ì—ë§Œ GitHub Actionsê°€ ì‹¤í–‰ë˜ë„ë¡ í•œë‹¤.</p>
<h3>[3] env</h3>
<p>í•´ë‹¹ ì•¡ì…˜ì—ì„œ ì‚¬ìš©í•  ë³€ìˆ˜ë¥¼ ì •ì˜í•œë‹¤. ì—¬ê¸°ì„œ ì •ì˜í•œ ë³€ìˆ˜ëŠ” ì•¡ì…˜ ë‚´ë¶€ì—ì„œ <code>${{ env.ë³€ìˆ˜ëª… }}</code> ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.</p>
<p>ë§Œì•½ ì—¬ëŸ¬ ì•¡ì…˜ì—ì„œ ì‚¬ìš©í•  ë³€ìˆ˜ë¥¼ ê³µí†µì ìœ¼ë¡œ ì •ì˜í•˜ê³  ì‹¶ë‹¤ë©´, GitHub ë ˆí¬ì˜ ì„¤ì •ì— ë“¤ì–´ê°€ì„œ Repository variableì„ ì„¤ì •í•˜ë©´ <code>${{ vars.ë³€ìˆ˜ëª… }}</code> ìœ¼ë¡œ ì•¡ì…˜ ë‚´ë¶€ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤ (ë‹¤ë§Œ ì´ ë³€ìˆ˜ëŠ” ì™¸ë¶€ì— ê³µê°œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì‹œí¬ë¦¿ í‚¤ ê°™ì€ ë¯¼ê°í•œ ì •ë³´ëŠ” Secret variableë¡œ ì„¤ì •í•´ì„œ <code>${{ secrets.ë³€ìˆ˜ëª… }}</code> ìœ¼ë¡œ ì‚¬ìš©í•˜ì.</p>
<h3>[4] job</h3>
<p>ì•¡ì…˜ì´ ì‹¤í–‰ë  ë•Œ ìˆ˜í–‰í•  ì‘ì—…(<code>job</code>)ë“¤ì„ ì •ì˜í•œë‹¤.</p>
<p>ì—¬ê¸°ì„œëŠ” ì„œë²„ íŒŒì¼ì„ ë¹Œë“œí•˜ëŠ” ì‘ì—…ì¸ <code>build</code> ì™€, í•´ë‹¹ ë¹Œë“œ íŒŒì¼ì„ ë°°í¬í•˜ëŠ” <code>deploy</code> ë‘ ê°œì˜ ì¡ì´ ì •ì˜ë˜ì—ˆë‹¤. ê·¸ë¦¬ê³  ì¡ë“¤ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë³‘ë ¬ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ë§Œ ì—¬ê¸°ì„œëŠ” <code>build</code> ì‘ì—…ì´ ëë‚œ í›„ì—ë§Œ <code>deploy</code> ì‘ì—…ì„ ì‹¤í–‰í•´ì•¼ í•˜ë¯€ë¡œ <code>needs</code> ì˜µì…˜ì„ ì„¤ì •í•´ì„œ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë˜ê²Œ í•˜ì˜€ë‹¤.</p>
<p>job ë‚´ë¶€ì˜ ìˆœì„œë“¤ì€ <code>step</code> ì„ í†µí•´ ì •ì˜í•œë‹¤.</p>
<h3>[5] job: build</h3>
<p>build ì¡ì€ ubuntu í™˜ê²½ì—ì„œ ì‹¤í–‰(<code>runs-on</code>)í•˜ê³ , ë³€ìˆ˜ì— ì„¤ì •í•´ë‘” í´ë”ë¥¼(<code>working-directory</code>) í˜„ì¬ ë””ë ‰í„°ë¦¬ë¡œ ì„¤ì •í•œë‹¤.</p>
<h4>5-1</h4>
<p>ê°€ìƒë¨¸ì‹ ì— í•´ë‹¹ ë ˆí¬ë¥¼ ê°€ì ¸ì˜¨ë‹¤.</p>
<h4>5-2</h4>
<p>Spring ì„œë²„ ë¹Œë“œë¥¼ ìœ„í•´ JDKë¥¼ ì„¤ì¹˜í•œë‹¤.</p>
<h4>5-3, 5-4</h4>
<p>Gradlewë¡œ ë¹Œë“œ í•  ìˆ˜ ìˆë„ë¡ ì‹¤í–‰ê¶Œí•œì„ ë¶€ì—¬í•˜ê³ , ì„œë²„ë¥¼ ë¹Œë“œí•œë‹¤.</p>
<h4>5-5</h4>
<p>ë¹Œë“œëœ ì„œë²„ë¥¼ AWSì— ì—…ë¡œë“œí•˜ê¸° ìœ„í•´ì„œëŠ” ì—…ë¡œë“œí•  AWS ê³„ì •ì— ëŒ€í•œ ì¸ì¦ì´ í•„ìš”í•˜ë‹¤.</p>
<p>ì´ì „ê¹Œì§€ëŠ” ê¹ƒí—™ ì•¡ì…˜ì„ ì´ìš©í•˜ëŠ” IAM ìœ ì €ë¥¼ ìƒì„±í•œ í›„ì— AWS ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ë°œê¸‰í•´ì„œ ì¸ì¦í•˜ëŠ” ì•„ë˜ì™€ ê°™ì€ ë°©ì‹ì´ ë§ì•˜ì§€ë§Œ,</p>
<pre style="display:block;overflow-x:auto;background:#2d2d2d;color:#cccccc;padding:0.5em"><code class="language-yaml">uses: aws-actions/configure-aws-credentials@v1
with:
  aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
  aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
  aws-region: ${{ secrets.AWS_REGION }}</code></pre>
<p><a href="https://github.com/aws-actions/configure-aws-credentials">https://github.com/aws-actions/configure-aws-credentials</a> ì˜ ë¦¬ë“œë¯¸ë¥¼ ë³´ë©´, <a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services">GitHub&#x27;s OIDC provider</a> ë¥¼ ì´ìš©í•´ ì¸ì¦í•˜ëŠ” ë°©ì‹ì„ ì¶”ì²œí•˜ê³  ìˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” OpenID Connectë¥¼ í†µí•´ ì¸ì¦í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í–ˆë‹¤.</p>
<p>ì´ ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ 1. í‚¤ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì¬ë°œê¸‰í•˜ê±°ë‚˜ 2. í”„ë¡œì íŠ¸ë§ˆë‹¤ í‚¤ë¥¼ ìƒˆë¡œ ë°œê¸‰í•˜ëŠ” ê·€ì°®ì€ ê³¼ì •ì„ ìƒëµí•  ìˆ˜ ìˆë‹¤.</p>
<h4>OIDC ì…‹ì—…í•˜ê¸°</h4>
<p><strong>1) ìê²© ì¦ëª… ê³µê¸‰ì ì¶”ê°€</strong></p>
<p>ì´ ë°©ì‹ì„ ì‚¬ìš©í•˜ë ¤ë©´ AWSì˜ IAM ìœ ì € ì½˜ì†”ì— ë“¤ì–´ê°€ì„œ, ê³µê¸‰ì URLì€ <code>https://token.actions.githubusercontent.com</code>, ëŒ€ìƒì€ <code>http://sts.amazonaws.com</code> ìœ¼ë¡œ ì„¤ì •í•œ í›„ â€˜ê³µê¸‰ì ì¶”ê°€&#x27;ë¥¼ ëˆ„ë¥¸ë‹¤.</p>
<p><img src="/github-aws-ci-cd-1.png" alt=""/></p>
<p><strong>2) ì—­í•  ë° ì‹ ë¢° ê´€ê³„ ì„¤ì •</strong></p>
<p>GitHub Actionsì—ì„œ AWSì˜ S3 ë²„í‚·ê³¼ CodeDeployì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•˜ë¯€ë¡œ ê¶Œí•œì— <code>AmazonS3FullAccess</code> ì™€ <code>AWSCodeDeployFullAccess</code> ê¶Œí•œì„ ì£¼ê³ , <strong>ì‹ ë¢° ê´€ê³„</strong>ë¥¼ ë‹¤ìŒì²˜ëŸ¼ ì„¤ì •í•˜ë©´ OIDC ë¥¼ ìœ„í•œ ì—­í•  ìƒì„±ì´ ì™„ë£Œëœë‹¤.</p>
<pre style="display:block;overflow-x:auto;background:#2d2d2d;color:#cccccc;padding:0.5em"><code class="language-json">{
  &quot;Version&quot;: &quot;2012-10-17&quot;,
  &quot;Statement&quot;: [
      {
          &quot;Effect&quot;: &quot;Allow&quot;,
          &quot;Principal&quot;: {
              &quot;Federated&quot;: // ì•„ê¹Œ ë°œê¸‰í•œ ìê²© ì¦ëª… ê³µê¸‰ìì˜ ARNì„ ì…ë ¥í•œë‹¤. ex. &quot;arn:aws:iam::0123456789:oidc-provider/token.actions.githubusercontent.com&quot;
          },
          &quot;Action&quot;: &quot;sts:AssumeRoleWithWebIdentity&quot;,
          &quot;Condition&quot;: {
              &quot;StringEquals&quot;: {
                  &quot;token.actions.githubusercontent.com:aud&quot;: &quot;sts.amazonaws.com&quot;
              },
              &quot;StringLike&quot;: {
                  &quot;token.actions.githubusercontent.com:sub&quot;: // ì ‘ê·¼í•  ìœ ì €, ë ˆí¬, ë¸Œëœì¹˜ ë“±ì„ ì •ì˜í•œë‹¤. ex. &quot;repo:ORG_OR_USER_NAME/REPOSITORY&quot;
              }
          }
      }
  ]
}</code></pre>
<p><strong>3) ë ˆí¬ì— í•´ë‹¹ ì—­í• ì„ ì‹œí¬ë¦¿ ë³€ìˆ˜ë¡œ ì •ì˜</strong></p>
<p>ìƒì„±í•œ ì—­í• (Role)ì˜ ARNì„ í•´ë‹¹ ë ˆí¬ì— <code>AWS_ROLE_TO_ASSUME</code> ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ì‹œí¬ë¦¿ í‚¤ë¡œ ì„¤ì •í•œë‹¤.</p>
<h4>5-6</h4>
<p>AWS ì¸ì¦ì´ ì™„ë£Œë˜ë©´ ì„œë²„ë¥¼ ë„ìš¸ ë•Œ ì •ì˜í•  í™˜ê²½ ë³€ìˆ˜ê°€ ë‹´ê¸´ íŒŒì¼ì„ ìƒì„±í•œë‹¤. ê¹ƒì— ì˜¬ë¼ê°€ë©´ ì•ˆë˜ëŠ” ë¯¼ê°í•œ ì •ë³´ë‚˜ ê¹ƒì— ì˜¬ë¼ê°ˆ í•„ìš”ê°€ ì—†ëŠ” ë³€ìˆ˜ë“¤ì„ ì„œë²„ì— ì „ë‹¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤. <code>.env</code> íŒŒì¼ì€ KEY=VALUE ê°€ ì—¬ëŸ¬ ì¤„ì¸ í˜•ì‹ìœ¼ë¡œ ì •ì˜ë˜ëŠ”ë°, ì´ í˜•ì‹ì€ linuxì—ì„œ <code>cat .env | xargs</code> ëª…ë ¹ì–´ë¥¼ í†µí•´ ë°”ë¡œ ì‹œìŠ¤í…œ ë³€ìˆ˜ë¡œ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©° Spring ì—ì„œëŠ” ì„¤ì •íŒŒì¼ì¸ <code>application.yaml</code> ì—ì„œ ì‹œìŠ¤í…œ ë³€ìˆ˜ë¥¼ ë°”ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.</p>
<h4>5-7</h4>
<p>ì´ì œ ì„œë²„ì— ë„ìš¸ íŒŒì¼ë“¤ì„ <code>zip</code> ìœ¼ë¡œ ì••ì¶•í•˜ê³  aws cli ëª…ë ¹ì–´ë¥¼ í†µí•´ s3 ë²„í‚·ì— ì˜¬ë¦°ë‹¤. <code>zip</code> íŒŒì¼ì˜ ì´ë¦„ì€ ì‰¬ìš´ êµ¬ë¶„ì„ ìœ„í•´ ê¹ƒí—™ ì»¤ë°‹ ID(<code>$GITHUB_SHA</code>)ë¡œ ì •ì˜í•˜ì˜€ë‹¤.</p>
<h3>[6] job: deploy</h3>
<p>ì•ì„  <code>build</code> jobì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ ì´ ì‘ì—…ì´ ì‹¤í–‰ëœë‹¤.</p>
<p>aws cli ëª…ë ¹ì–´ì¸ <code>aws deploy code-deployment</code> ëª…ë ¹ì–´ë¥¼ í†µí•´ CodeDeployê°€ ì‹¤í–‰ë˜ë„ë¡ ìš”ì²­í•œë‹¤.</p>
<p>ì´ ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ê¸° ìœ„í•´ì„œëŠ” CodeDeployì— ì„œë²„ ë°°í¬ë¥¼ ìœ„í•œ CodeDeploy Groupê³¼ CodeDeploy Appì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘ì–´ì•¼ í•œë‹¤.</p>
<h4></h4></article><div><hr class="border-t border-neutral-300 my-8 sm:my-16"/><section></section></div></div></main><footer class="font-title py-4 sm:py-8 flex flex-col items-center text-neutral-600"><div class="flex flex-row my-2"><div class="flex items-center py-1"><a class="m-2 " href="https://github.com/100paperkite"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="w-7 h-7" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.976 0A7.977 7.977 0 0 0 0 7.976c0 3.522 2.3 6.507 5.431 7.584.392.049.538-.196.538-.392v-1.37c-2.201.49-2.69-1.076-2.69-1.076-.343-.93-.881-1.175-.881-1.175-.734-.489.048-.489.048-.489.783.049 1.224.832 1.224.832.734 1.223 1.859.88 2.3.685.048-.538.293-.88.489-1.076-1.762-.196-3.621-.881-3.621-3.964 0-.88.293-1.566.832-2.153-.05-.147-.343-.978.098-2.055 0 0 .685-.196 2.201.832.636-.196 1.322-.245 2.007-.245s1.37.098 2.006.245c1.517-1.027 2.202-.832 2.202-.832.44 1.077.146 1.908.097 2.104a3.16 3.16 0 0 1 .832 2.153c0 3.083-1.86 3.719-3.62 3.915.293.244.538.733.538 1.467v2.202c0 .196.146.44.538.392A7.984 7.984 0 0 0 16 7.976C15.951 3.572 12.38 0 7.976 0z"></path></svg></a><a class="m-2" href="mailto:100.paperkite@gmail.com"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="w-7 h-7" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 3.5l.5-.5h13l.5.5v9l-.5.5h-13l-.5-.5v-9zm1 1.035V12h12V4.536L8.31 8.9H7.7L2 4.535zM13.03 4H2.97L8 7.869 13.03 4z"></path></svg></a></div></div><span class="text-sm text-neutral-500">100paperkite<!-- --> Â© <!-- -->2023</span></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"[GitHub Actions, AWSë¡œ CI/CD êµ¬ì¶•í•˜ê¸°] - 1. GitHub Actions êµ¬ì„±í•˜ê¸°","description":null,"uploaded":"2023-03-03T09:41:29.368Z","updated":null,"tags":["ci/cd","aws","github"],"draft":false},"slug":"github-aws-ci-cd","mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      h2: \"h2\",\n      p: \"p\",\n      img: \"img\",\n      ol: \"ol\",\n      li: \"li\",\n      code: \"code\",\n      h3: \"h3\",\n      pre: \"pre\",\n      h4: \"h4\",\n      a: \"a\",\n      strong: \"strong\"\n    }, _provideComponents(), props.components);\n    return _jsxs(_Fragment, {\n      children: [_jsx(_components.h2, {\n        children: \"Overview\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.img, {\n          src: \"/github-aws-ci-cd-0.png\",\n          alt: \"\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"ì„œë²„ ë°°í¬ëŠ” ë‹¤ìŒ ê³¼ì •ì„ ê±°ì³ ì´ë£¨ì–´ì§„ë‹¤.\"\n      }), \"\\n\", _jsxs(_components.ol, {\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"ë ˆí¬ì§€í† ë¦¬ì˜ \", _jsx(_components.code, {\n            children: \"main\"\n          }), \" ë¸Œëœì¹˜ì— í‘¸ì‹œí•˜ë©´ GitHub Actionì´ ì‹¤í–‰\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"GitHub Actions ì‹¤í–‰\", \"\\n\", _jsxs(_components.ol, {\n            children: [\"\\n\", _jsx(_components.li, {\n              children: \"ì„œë²„ë¥¼ ë¹Œë“œ\"\n            }), \"\\n\", _jsx(_components.li, {\n              children: \"OpenID Connectë¡œ AWS ì¸ì¦\"\n            }), \"\\n\", _jsx(_components.li, {\n              children: \"ë¹Œë“œëœ íŒŒì¼ì„ AWS S3ì— ì—…ë¡œë“œ\"\n            }), \"\\n\", _jsx(_components.li, {\n              children: \"ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ AWS CodeDeployë¥¼ ì‹¤í–‰\"\n            }), \"\\n\"]\n          }), \"\\n\"]\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"AWS CodeDeployê°€ S3ì— ì—…ë¡œë“œëœ zip íŒŒì¼ì„ ë¯¸ë¦¬ ì •ì˜í•´ë‘” EC2 ì¸ìŠ¤í„´ìŠ¤ì— ì—…ë¡œë“œ\"\n        }), \"\\n\", _jsx(_components.li, {\n          children: \"CodeDeployê°€ ì†ŒìŠ¤ì˜ ì„¤ì •íŒŒì¼(appspec.yml)ì— ë”°ë¼ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ì„œë²„ë¥¼ EC2 ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ì‹¤í–‰ì‹œí‚´\"\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"GitHub Actions\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"GitHub ActionsëŠ” ê¹ƒ ë ˆí¬ì§€í† ë¦¬ì— \", _jsx(_components.code, {\n          children: \".github/workflow\"\n        }), \" ë””ë ‰í„°ë¦¬ë¥¼ ë§Œë“¤ê³  \", _jsx(_components.code, {\n          children: \"yaml\"\n        }), \" í™•ì¥ì íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤. \", _jsx(_components.code, {\n          children: \"main\"\n        }), \" ë¸Œëœì¹˜ì— í‘¸ì‹œë˜ë©´ ìë™ìœ¼ë¡œ ì„œë²„ë¥¼ ë¹Œë“œí•´ì„œ AWS EC2ì— ë°°í¬í•˜ëŠ” ë‹¤ìŒ íŒŒì¼ì„ ë³´ë©´ì„œ ê³¼ì •ì„ ì‚´í´ë³´ì.\"]\n      }), \"\\n\", _jsxs(_components.h3, {\n        children: [_jsx(_components.code, {\n          children: \"yaml\"\n        }), \" íŒŒì¼\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-yaml\",\n          children: \"# [1]\\nname: build and deploy a spring boot server application\\n\\n# [2]\\non:\\n  push:\\n    branches:\\n      - main\\n\\n# [3]\\nenv:\\n  applicationfolder: backend/gfi\\n  AWS_REGION: # AWS ë¦¬ì „. ex. ap-north-east-2\\n  S3_BUCKET: # ë¹Œë“œ íŒŒì¼ì„ ì—…ë¡œë“œí•  S3 ë²„í‚· ì´ë¦„\\n  CODE_DEPLOY_APP_NAME: # CodeDeployì— ì„¤ì •í•œ ì•± ì´ë¦„\\n  CODE_DEPLOY_GROUP_NAME: # CodeDeployì— ì„¤ì •í•œ ê·¸ë£¹ ì´ë¦„\\n\\n#[4]\\njobs:\\n  # [5]\\n  build:\\n    name: Build and Package\\n    runs-on: ubuntu-latest\\n    defaults:\\n      run:\\n        working-directory: ${{ env.applicationfolder }}\\n\\n    # OIDCì— ì“°ì´ëŠ” ID í† í° ë°œê¸‰ì„ ìœ„í•´ ì •ì˜\\n    permissions:\\n      id-token: write\\n      contents: read\\n\\n    steps:\\n\\t  # [5-1]\\n      - uses: actions/checkout@v3\\n\\n\\t  # [5-2]\\n      - name: Set up JDK 17\\n        uses: actions/setup-java@v3\\n        with:\\n          java-version: '17'\\n          distribution: 'temurin'\\n\\n\\t  # [5-3]\\n      - name: Grant execute permission to gradlew\\n        run: chmod +x ./gradlew\\n        shell: bash\\n\\n\\t  # [5-4]\\n      - name: Execute Gradle build\\n        run: ./gradlew build\\n\\n\\t  # [5-5] OIDC\\n      - name: Configure AWS credentials\\n        uses: aws-actions/configure-aws-credentials@v1\\n        with:\\n          role-to-assume: ${{ secrets.AWS_ROLE_TO_ASSUME }}\\n          aws-region: ${{ env.AWS_REGION }}\\n\\n\\t  # [5-6]\\n      - name: Create a .env file\\n        run: |\\n          echo \\\"PORT=${{ vars.SERVER_PORT }}\\\" \u003e\u003e .env\\n\\n\\t  # [5-7]\\n      - name: Make zip file\\n        run: zip -r $GITHUB_SHA.zip ./\\n        shell: bash\\n\\n      - name: Upload Artifact to s3\\n        run: aws s3 cp $GITHUB_SHA.zip s3://${{ env.S3_BUCKET }}/\\n\\n  # [6]\\n  deploy:\\n    needs: build\\n    runs-on: ubuntu-latest\\n\\n    # OIDCì— ì“°ì´ëŠ” ID í† í° ë°œê¸‰ì„ ìœ„í•´ ì •ì˜\\n    permissions:\\n      id-token: write\\n      contents: read\\n\\n    steps:\\n      - uses: actions/checkout@v2\\n\\n      - uses: aws-actions/configure-aws-credentials@v1\\n        with:\\n          role-to-assume: ${{ secrets.AWS_ROLE_TO_ASSUME }}\\n          aws-region: ${{ env.AWS_REGION }}\\n      - run: |\\n          aws deploy create-deployment \\\\\\n            --application-name ${{ env.CODE_DEPLOY_APP_NAME }} \\\\\\n            --deployment-group-name ${{ env.CODE_DEPLOY_GROUP_NAME }} \\\\\\n            --s3-location bucket=${{ env.S3_BUCKET }},bundleType=zip,key=$GITHUB_SHA.zip\\n\"\n        })\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"[1] name\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"ì‹¤í–‰ë  GitHub Actionsì˜ ì´ë¦„ì„ ì •ì˜í•œë‹¤.\"\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"[2] on\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.code, {\n          children: \"main\"\n        }), \" ë¸Œëœì¹˜ì— í‘¸ì‹œëœ ê²½ìš°ì—ë§Œ GitHub Actionsê°€ ì‹¤í–‰ë˜ë„ë¡ í•œë‹¤.\"]\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"[3] env\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"í•´ë‹¹ ì•¡ì…˜ì—ì„œ ì‚¬ìš©í•  ë³€ìˆ˜ë¥¼ ì •ì˜í•œë‹¤. ì—¬ê¸°ì„œ ì •ì˜í•œ ë³€ìˆ˜ëŠ” ì•¡ì…˜ ë‚´ë¶€ì—ì„œ \", _jsx(_components.code, {\n          children: \"${{ env.ë³€ìˆ˜ëª… }}\"\n        }), \" ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"ë§Œì•½ ì—¬ëŸ¬ ì•¡ì…˜ì—ì„œ ì‚¬ìš©í•  ë³€ìˆ˜ë¥¼ ê³µí†µì ìœ¼ë¡œ ì •ì˜í•˜ê³  ì‹¶ë‹¤ë©´, GitHub ë ˆí¬ì˜ ì„¤ì •ì— ë“¤ì–´ê°€ì„œ Repository variableì„ ì„¤ì •í•˜ë©´ \", _jsx(_components.code, {\n          children: \"${{ vars.ë³€ìˆ˜ëª… }}\"\n        }), \" ìœ¼ë¡œ ì•¡ì…˜ ë‚´ë¶€ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤ (ë‹¤ë§Œ ì´ ë³€ìˆ˜ëŠ” ì™¸ë¶€ì— ê³µê°œë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ì‹œí¬ë¦¿ í‚¤ ê°™ì€ ë¯¼ê°í•œ ì •ë³´ëŠ” Secret variableë¡œ ì„¤ì •í•´ì„œ \", _jsx(_components.code, {\n          children: \"${{ secrets.ë³€ìˆ˜ëª… }}\"\n        }), \" ìœ¼ë¡œ ì‚¬ìš©í•˜ì.\"]\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"[4] job\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"ì•¡ì…˜ì´ ì‹¤í–‰ë  ë•Œ ìˆ˜í–‰í•  ì‘ì—…(\", _jsx(_components.code, {\n          children: \"job\"\n        }), \")ë“¤ì„ ì •ì˜í•œë‹¤.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"ì—¬ê¸°ì„œëŠ” ì„œë²„ íŒŒì¼ì„ ë¹Œë“œí•˜ëŠ” ì‘ì—…ì¸ \", _jsx(_components.code, {\n          children: \"build\"\n        }), \" ì™€, í•´ë‹¹ ë¹Œë“œ íŒŒì¼ì„ ë°°í¬í•˜ëŠ” \", _jsx(_components.code, {\n          children: \"deploy\"\n        }), \" ë‘ ê°œì˜ ì¡ì´ ì •ì˜ë˜ì—ˆë‹¤. ê·¸ë¦¬ê³  ì¡ë“¤ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë³‘ë ¬ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ë§Œ ì—¬ê¸°ì„œëŠ” \", _jsx(_components.code, {\n          children: \"build\"\n        }), \" ì‘ì—…ì´ ëë‚œ í›„ì—ë§Œ \", _jsx(_components.code, {\n          children: \"deploy\"\n        }), \" ì‘ì—…ì„ ì‹¤í–‰í•´ì•¼ í•˜ë¯€ë¡œ \", _jsx(_components.code, {\n          children: \"needs\"\n        }), \" ì˜µì…˜ì„ ì„¤ì •í•´ì„œ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰ë˜ê²Œ í•˜ì˜€ë‹¤.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"job ë‚´ë¶€ì˜ ìˆœì„œë“¤ì€ \", _jsx(_components.code, {\n          children: \"step\"\n        }), \" ì„ í†µí•´ ì •ì˜í•œë‹¤.\"]\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"[5] job: build\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"build ì¡ì€ ubuntu í™˜ê²½ì—ì„œ ì‹¤í–‰(\", _jsx(_components.code, {\n          children: \"runs-on\"\n        }), \")í•˜ê³ , ë³€ìˆ˜ì— ì„¤ì •í•´ë‘” í´ë”ë¥¼(\", _jsx(_components.code, {\n          children: \"working-directory\"\n        }), \") í˜„ì¬ ë””ë ‰í„°ë¦¬ë¡œ ì„¤ì •í•œë‹¤.\"]\n      }), \"\\n\", _jsx(_components.h4, {\n        children: \"5-1\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"ê°€ìƒë¨¸ì‹ ì— í•´ë‹¹ ë ˆí¬ë¥¼ ê°€ì ¸ì˜¨ë‹¤.\"\n      }), \"\\n\", _jsx(_components.h4, {\n        children: \"5-2\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Spring ì„œë²„ ë¹Œë“œë¥¼ ìœ„í•´ JDKë¥¼ ì„¤ì¹˜í•œë‹¤.\"\n      }), \"\\n\", _jsx(_components.h4, {\n        children: \"5-3, 5-4\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"Gradlewë¡œ ë¹Œë“œ í•  ìˆ˜ ìˆë„ë¡ ì‹¤í–‰ê¶Œí•œì„ ë¶€ì—¬í•˜ê³ , ì„œë²„ë¥¼ ë¹Œë“œí•œë‹¤.\"\n      }), \"\\n\", _jsx(_components.h4, {\n        children: \"5-5\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"ë¹Œë“œëœ ì„œë²„ë¥¼ AWSì— ì—…ë¡œë“œí•˜ê¸° ìœ„í•´ì„œëŠ” ì—…ë¡œë“œí•  AWS ê³„ì •ì— ëŒ€í•œ ì¸ì¦ì´ í•„ìš”í•˜ë‹¤.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"ì´ì „ê¹Œì§€ëŠ” ê¹ƒí—™ ì•¡ì…˜ì„ ì´ìš©í•˜ëŠ” IAM ìœ ì €ë¥¼ ìƒì„±í•œ í›„ì— AWS ì•¡ì„¸ìŠ¤ í‚¤ë¥¼ ë°œê¸‰í•´ì„œ ì¸ì¦í•˜ëŠ” ì•„ë˜ì™€ ê°™ì€ ë°©ì‹ì´ ë§ì•˜ì§€ë§Œ,\"\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-yaml\",\n          children: \"uses: aws-actions/configure-aws-credentials@v1\\nwith:\\n  aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}\\n  aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}\\n  aws-region: ${{ secrets.AWS_REGION }}\\n\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.a, {\n          href: \"https://github.com/aws-actions/configure-aws-credentials\",\n          children: \"https://github.com/aws-actions/configure-aws-credentials\"\n        }), \" ì˜ ë¦¬ë“œë¯¸ë¥¼ ë³´ë©´, \", _jsx(_components.a, {\n          href: \"https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/configuring-openid-connect-in-amazon-web-services\",\n          children: \"GitHub's OIDC provider\"\n        }), \" ë¥¼ ì´ìš©í•´ ì¸ì¦í•˜ëŠ” ë°©ì‹ì„ ì¶”ì²œí•˜ê³  ìˆìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œëŠ” OpenID Connectë¥¼ í†µí•´ ì¸ì¦í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í–ˆë‹¤.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"ì´ ë°©ì‹ì„ ì‚¬ìš©í•˜ë©´ 1. í‚¤ë¥¼ ì£¼ê¸°ì ìœ¼ë¡œ ì¬ë°œê¸‰í•˜ê±°ë‚˜ 2. í”„ë¡œì íŠ¸ë§ˆë‹¤ í‚¤ë¥¼ ìƒˆë¡œ ë°œê¸‰í•˜ëŠ” ê·€ì°®ì€ ê³¼ì •ì„ ìƒëµí•  ìˆ˜ ìˆë‹¤.\"\n      }), \"\\n\", _jsx(_components.h4, {\n        children: \"OIDC ì…‹ì—…í•˜ê¸°\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.strong, {\n          children: \"1) ìê²© ì¦ëª… ê³µê¸‰ì ì¶”ê°€\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"ì´ ë°©ì‹ì„ ì‚¬ìš©í•˜ë ¤ë©´ AWSì˜ IAM ìœ ì € ì½˜ì†”ì— ë“¤ì–´ê°€ì„œ, ê³µê¸‰ì URLì€ \", _jsx(_components.code, {\n          children: \"https://token.actions.githubusercontent.com\"\n        }), \", ëŒ€ìƒì€ \", _jsx(_components.code, {\n          children: \"http://sts.amazonaws.com\"\n        }), \" ìœ¼ë¡œ ì„¤ì •í•œ í›„ â€˜ê³µê¸‰ì ì¶”ê°€'ë¥¼ ëˆ„ë¥¸ë‹¤.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.img, {\n          src: \"/github-aws-ci-cd-1.png\",\n          alt: \"\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.strong, {\n          children: \"2) ì—­í•  ë° ì‹ ë¢° ê´€ê³„ ì„¤ì •\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"GitHub Actionsì—ì„œ AWSì˜ S3 ë²„í‚·ê³¼ CodeDeployì— ì ‘ê·¼í•  ìˆ˜ ìˆì–´ì•¼ í•˜ë¯€ë¡œ ê¶Œí•œì— \", _jsx(_components.code, {\n          children: \"AmazonS3FullAccess\"\n        }), \" ì™€ \", _jsx(_components.code, {\n          children: \"AWSCodeDeployFullAccess\"\n        }), \" ê¶Œí•œì„ ì£¼ê³ , \", _jsx(_components.strong, {\n          children: \"ì‹ ë¢° ê´€ê³„\"\n        }), \"ë¥¼ ë‹¤ìŒì²˜ëŸ¼ ì„¤ì •í•˜ë©´ OIDC ë¥¼ ìœ„í•œ ì—­í•  ìƒì„±ì´ ì™„ë£Œëœë‹¤.\"]\n      }), \"\\n\", _jsx(_components.pre, {\n        children: _jsx(_components.code, {\n          className: \"language-json\",\n          children: \"{\\n  \\\"Version\\\": \\\"2012-10-17\\\",\\n  \\\"Statement\\\": [\\n      {\\n          \\\"Effect\\\": \\\"Allow\\\",\\n          \\\"Principal\\\": {\\n              \\\"Federated\\\": // ì•„ê¹Œ ë°œê¸‰í•œ ìê²© ì¦ëª… ê³µê¸‰ìì˜ ARNì„ ì…ë ¥í•œë‹¤. ex. \\\"arn:aws:iam::0123456789:oidc-provider/token.actions.githubusercontent.com\\\"\\n          },\\n          \\\"Action\\\": \\\"sts:AssumeRoleWithWebIdentity\\\",\\n          \\\"Condition\\\": {\\n              \\\"StringEquals\\\": {\\n                  \\\"token.actions.githubusercontent.com:aud\\\": \\\"sts.amazonaws.com\\\"\\n              },\\n              \\\"StringLike\\\": {\\n                  \\\"token.actions.githubusercontent.com:sub\\\": // ì ‘ê·¼í•  ìœ ì €, ë ˆí¬, ë¸Œëœì¹˜ ë“±ì„ ì •ì˜í•œë‹¤. ex. \\\"repo:ORG_OR_USER_NAME/REPOSITORY\\\"\\n              }\\n          }\\n      }\\n  ]\\n}\\n\"\n        })\n      }), \"\\n\", _jsx(_components.p, {\n        children: _jsx(_components.strong, {\n          children: \"3) ë ˆí¬ì— í•´ë‹¹ ì—­í• ì„ ì‹œí¬ë¦¿ ë³€ìˆ˜ë¡œ ì •ì˜\"\n        })\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"ìƒì„±í•œ ì—­í• (Role)ì˜ ARNì„ í•´ë‹¹ ë ˆí¬ì— \", _jsx(_components.code, {\n          children: \"AWS_ROLE_TO_ASSUME\"\n        }), \" ë¼ëŠ” ì´ë¦„ì„ ê°€ì§„ ì‹œí¬ë¦¿ í‚¤ë¡œ ì„¤ì •í•œë‹¤.\"]\n      }), \"\\n\", _jsx(_components.h4, {\n        children: \"5-6\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"AWS ì¸ì¦ì´ ì™„ë£Œë˜ë©´ ì„œë²„ë¥¼ ë„ìš¸ ë•Œ ì •ì˜í•  í™˜ê²½ ë³€ìˆ˜ê°€ ë‹´ê¸´ íŒŒì¼ì„ ìƒì„±í•œë‹¤. ê¹ƒì— ì˜¬ë¼ê°€ë©´ ì•ˆë˜ëŠ” ë¯¼ê°í•œ ì •ë³´ë‚˜ ê¹ƒì— ì˜¬ë¼ê°ˆ í•„ìš”ê°€ ì—†ëŠ” ë³€ìˆ˜ë“¤ì„ ì„œë²„ì— ì „ë‹¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤. \", _jsx(_components.code, {\n          children: \".env\"\n        }), \" íŒŒì¼ì€ KEY=VALUE ê°€ ì—¬ëŸ¬ ì¤„ì¸ í˜•ì‹ìœ¼ë¡œ ì •ì˜ë˜ëŠ”ë°, ì´ í˜•ì‹ì€ linuxì—ì„œ \", _jsx(_components.code, {\n          children: \"cat .env | xargs\"\n        }), \" ëª…ë ¹ì–´ë¥¼ í†µí•´ ë°”ë¡œ ì‹œìŠ¤í…œ ë³€ìˆ˜ë¡œ ë§Œë“¤ ìˆ˜ ìˆìœ¼ë©° Spring ì—ì„œëŠ” ì„¤ì •íŒŒì¼ì¸ \", _jsx(_components.code, {\n          children: \"application.yaml\"\n        }), \" ì—ì„œ ì‹œìŠ¤í…œ ë³€ìˆ˜ë¥¼ ë°”ë¡œ ë°›ì„ ìˆ˜ ìˆë‹¤.\"]\n      }), \"\\n\", _jsx(_components.h4, {\n        children: \"5-7\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"ì´ì œ ì„œë²„ì— ë„ìš¸ íŒŒì¼ë“¤ì„ \", _jsx(_components.code, {\n          children: \"zip\"\n        }), \" ìœ¼ë¡œ ì••ì¶•í•˜ê³  aws cli ëª…ë ¹ì–´ë¥¼ í†µí•´ s3 ë²„í‚·ì— ì˜¬ë¦°ë‹¤. \", _jsx(_components.code, {\n          children: \"zip\"\n        }), \" íŒŒì¼ì˜ ì´ë¦„ì€ ì‰¬ìš´ êµ¬ë¶„ì„ ìœ„í•´ ê¹ƒí—™ ì»¤ë°‹ ID(\", _jsx(_components.code, {\n          children: \"$GITHUB_SHA\"\n        }), \")ë¡œ ì •ì˜í•˜ì˜€ë‹¤.\"]\n      }), \"\\n\", _jsx(_components.h3, {\n        children: \"[6] job: deploy\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"ì•ì„  \", _jsx(_components.code, {\n          children: \"build\"\n        }), \" jobì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ë©´ ì´ ì‘ì—…ì´ ì‹¤í–‰ëœë‹¤.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"aws cli ëª…ë ¹ì–´ì¸ \", _jsx(_components.code, {\n          children: \"aws deploy code-deployment\"\n        }), \" ëª…ë ¹ì–´ë¥¼ í†µí•´ CodeDeployê°€ ì‹¤í–‰ë˜ë„ë¡ ìš”ì²­í•œë‹¤.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"ì´ ì‘ì—…ì´ ì„±ê³µì ìœ¼ë¡œ ì™„ë£Œë˜ê¸° ìœ„í•´ì„œëŠ” CodeDeployì— ì„œë²„ ë°°í¬ë¥¼ ìœ„í•œ CodeDeploy Groupê³¼ CodeDeploy Appì„ ë¯¸ë¦¬ ë§Œë“¤ì–´ë‘ì–´ì•¼ í•œë‹¤.\"\n      }), \"\\n\", _jsx(_components.h4, {})]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"github-aws-ci-cd"},"buildId":"0xQjpLb5yay7gfVz4gblO","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>