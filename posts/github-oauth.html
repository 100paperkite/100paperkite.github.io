<!DOCTYPE html><html lang="ko-KR"><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><meta property="og:url" content="https://100paperkite.github.io"/><meta property="og:type" content="website"/><meta property="og:locale" content="ko-KR"/><meta property="og:site_name" content="paperkite.log 👋"/><title>프로젝트에 GitHub OAuth 적용하기 | paperkite.log 👋</title><meta name="robots" content="index,follow"/><meta name="description" content="프로젝트에 GitHub OAuth 적용하기"/><meta property="og:title" content="프로젝트에 GitHub OAuth 적용하기 | paperkite.log 👋"/><meta property="og:description" content="프로젝트에 GitHub OAuth 적용하기"/><script type="application/ld+json">{"@context":"https://schema.org","@type":"Blog","datePublished":"2022-12-13","description":"프로젝트에 GitHub OAuth 적용하기","mainEntityOfPage":{"@type":"WebPage","@id":"https://100paperkite.github.io/posts/github-oauth"},"headline":"프로젝트에 GitHub OAuth 적용하기","dateModified":"2022-12-13","author":{"@type":"Person","name":"100paperkite"}}</script><meta name="next-head-count" content="12"/><script id="gtag-init" strategy="afterInteractive">
              window.dataLayer = window.dataLayer || [];
              function gtag(){dataLayer.push(arguments);}
              gtag('js', new Date());
              gtag('config', 'G-FFSLQ27YMJ', {
                page_path: window.location.pathname,
              });
            </script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-FFSLQ27YMJ"></script><link rel="preload" href="/_next/static/css/3f8fa8df809fac07.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3f8fa8df809fac07.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-fd4cc7fd8dd8bbd7.js" defer=""></script><script src="/_next/static/chunks/framework-a070cbfff3c750c5.js" defer=""></script><script src="/_next/static/chunks/main-1b1db7be3343898e.js" defer=""></script><script src="/_next/static/chunks/pages/_app-c1e739f18573092f.js" defer=""></script><script src="/_next/static/chunks/0c428ae2-aee1a03cbb0f41ac.js" defer=""></script><script src="/_next/static/chunks/17007de1-711cf284c97b49d4.js" defer=""></script><script src="/_next/static/chunks/5386-90fb242547654fe3.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-bc57f9407ecafeac.js" defer=""></script><script src="/_next/static/b9Si3-7MjZM6Hz9lTfrhU/_buildManifest.js" defer=""></script><script src="/_next/static/b9Si3-7MjZM6Hz9lTfrhU/_ssgManifest.js" defer=""></script><script src="/_next/static/b9Si3-7MjZM6Hz9lTfrhU/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="flex flex-col min-h-screen"><nav class="flex justify-between sticky top-0 z-50 space-x-4 py-2"><a class="text-neutral-800 hover:text-neutral-600 text-lg md:text-xl font-medium mx-2 md:mx-6 my-1 md:my-2 p-2 " href="/">paperkite.log 👋</a></nav><main class="max-w-screen-md px-4 w-full mx-auto flex-grow font-body"><div class="px-2 md:px-4 py-2 md:py-4"><div class="border-b border-1 mb-4 sm:mb-6 border-dashed border-neutral-300"><div class="flex items-center my-1 md:my-2 gap-x-2"></div><h1 class="text-3xl sm:text-4xl font-bold mb-2 sm:mb-4 mt-6 sm:mt-10">프로젝트에 GitHub OAuth 적용하기</h1><div class="flex py-2 md:py-3 pl-1 text-neutral-500"><small class="">December 13, 2022<!-- -->에 작성</small><small class=""> · <!-- -->January 1, 1970<!-- -->에 변경됨</small></div></div><article class="max-w-none prose prose-neutral prose-sm sm:prose-base md:prose-md"><p>이전에 <code>good-first-issue</code> 이슈가 존재하는 GitHub 프로젝트 목록을 볼 수 있는 웹앱을 만드는 <a href="https://github.com/100paperkite/good-first-issue">토이프로젝트</a>를 진행했다.</p>
<p>이 프로젝트에서는 여러가지 깃헙 정보를 가져오기 위해서 GitHub API를 사용했는데, 특히 GitHub에서 GraphQL로 제공하는 API(레포 정보를 가져오거나 이슈를 가져오는 등등)를 사용해야 했었다.</p>
<p>그런데 GitHub에서는 GraphQL로 제공하는 API는 일반 REST API와 달리 <a href="https://docs.github.com/en/graphql/guides/forming-calls-with-graphql#authenticating-with-graphql">사용자 인증</a>이 필요했기 때문에 웹앱에서 사용자 인증을 했어야 했고, OAuth를 사용해보게 되었다. <small>(사실 GraphQL을 쓰지 않더라도 REST API 호출 수가 1시간에 60번인가로 너무 적었기 때문에 어찌 됐든 인증과정이 필요하긴 했다.)</small></p>
<h2>OAuth?</h2>
<p>OAuth는 인증을 위한 프로토콜로, 사용자가 다른 인터넷 서비스<small>(여기선 GitHub)</small>의 기능을 다른 애플리케이션에서도 사용할 수 있게 한 것이다.</p>
<h2>프로젝트에서 GitHub OAuth 인증 과정</h2>
<p>웹앱에서 Github의 GraphQL API를 사용하려면 POST 요청의 body에 깃헙에서 발급받은 token을 포함해서 요청해야 한다.</p>
<p>그렇기 때문에 깃헙으로부터 token을 발급 받아와야 하는데, 발급 과정은 다음과 같이 이루어진다.</p>
<ol>
<li>사용자가 클라이언트에서 깃헙에 로그인한다.</li>
<li>로그인이 완료되면 깃헙이 <code>access_token</code> 발급을 위한 <code>code</code>를 발급해준다. (리디렉션되면서 url 파라미터에 붙어온다)</li>
<li><strong>*</strong>클라이언트에서 <small>(직접 올린)</small>프록시 서버에 <code>code</code>를 보내서 토큰 발급을 요청한다.</li>
</ol>
<hr/>
<p><strong>*</strong>여기서 클라이언트에서 바로 <code>code</code> 로 깃헙에 <code>access_token</code>을 요청하지 않고, 외부 서버를 거치는 이유는 브라우저의 <strong>Same-Origin Policy</strong><small>(보안을 위해 프로토콜, 포트, 도메인이 같은 서버로만 요청을 할 수 있게 하는 정책)</small>때문이다.</p>
<p>이걸 해결하기 위해서는 요청을 받는 서버에서 CORS 설정을 해줘야 하지만 GitHub에서는 <code>access_token</code>발급에 해당 설정을 해두진 않아서 브라우저에서 바로 요청할 수 없다.</p>
<p>code를 발급받기 위해 깃헙에 보내는 요청은, 해당 요청의 응답 헤더를 보면 깃헙에서 <strong>access-control-allow-origin:</strong> * 로 설정해서 내려주고 있으므로 CORS 문제가 없다.</p>
<hr/>
<ol start="4">
<li>프록시 서버에서는 클라이언트의 요청을 code와 함께 받으면, <code>client_secret</code> 키(깃헙에 웹앱을 등록하면 발급해준다)와 함께 GitHub에 <code>access_token</code> 발급을 요청한다.</li>
<li>GitHub에서 해당 유저의 <code>access_token</code> 발급이 완료되면 클라이언트에 해당 토큰을 응답으로 보낸다.<!-- -->
<ul>
<li>이 프록시 서버는 내가 직접 올린 서버이므로 CORS 설정을 해주기 때문에 클라이언트에서 <code>CORS</code> 에러가 생기지 않는다.</li>
</ul>
</li>
<li>이제 클라이언트에서는 이 토큰으로 GitHub API를 요청할 수 있다. <small>(해당 토큰은 브라우저의 로컬 스토리지에 저장)</small></li>
</ol>
<h2>여담</h2>
<p>그런데 정리하면서 프로젝트를 확인했는데 프록시 서버가 동작하지 않아서 봤더니... 기존에 프록시 서버를 무료인 heroku로 올려놨었는데, 올해 11월 28일부터 프리 티어를 아예 없애서 프록시 서버가 꺼졌다.. 다른 프리티어 솔루션을 찾아서 다시 적용해야할 듯.</p>
<h2>참조</h2>
<ul>
<li><a href="https://docs.github.com/ko/developers/apps/building-oauth-apps/authorizing-oauth-apps">깃헙 OAuth 가이드 문서</a></li>
</ul></article><div><hr class="border-t border-neutral-300 my-8 sm:my-16"/><section></section></div></div></main><footer class="font-title py-4 sm:py-8 flex flex-col items-center text-neutral-600"><div class="flex flex-row my-2"><div class="flex items-center py-1"><a class="m-2 " href="https://github.com/100paperkite"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="w-7 h-7" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.976 0A7.977 7.977 0 0 0 0 7.976c0 3.522 2.3 6.507 5.431 7.584.392.049.538-.196.538-.392v-1.37c-2.201.49-2.69-1.076-2.69-1.076-.343-.93-.881-1.175-.881-1.175-.734-.489.048-.489.048-.489.783.049 1.224.832 1.224.832.734 1.223 1.859.88 2.3.685.048-.538.293-.88.489-1.076-1.762-.196-3.621-.881-3.621-3.964 0-.88.293-1.566.832-2.153-.05-.147-.343-.978.098-2.055 0 0 .685-.196 2.201.832.636-.196 1.322-.245 2.007-.245s1.37.098 2.006.245c1.517-1.027 2.202-.832 2.202-.832.44 1.077.146 1.908.097 2.104a3.16 3.16 0 0 1 .832 2.153c0 3.083-1.86 3.719-3.62 3.915.293.244.538.733.538 1.467v2.202c0 .196.146.44.538.392A7.984 7.984 0 0 0 16 7.976C15.951 3.572 12.38 0 7.976 0z"></path></svg></a><a class="m-2" href="mailto:100.paperkite@gmail.com"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" class="w-7 h-7" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M1 3.5l.5-.5h13l.5.5v9l-.5.5h-13l-.5-.5v-9zm1 1.035V12h12V4.536L8.31 8.9H7.7L2 4.535zM13.03 4H2.97L8 7.869 13.03 4z"></path></svg></a></div></div><span class="text-sm text-neutral-500">100paperkite<!-- --> © <!-- -->2023</span></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"frontMatter":{"title":"프로젝트에 GitHub OAuth 적용하기","description":null,"uploaded":"2022-12-13","updated":null,"tags":[],"draft":false},"slug":"github-oauth","mdxSource":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, {})\n  })) : _createMdxContent();\n  function _createMdxContent() {\n    const _components = Object.assign({\n      p: \"p\",\n      code: \"code\",\n      a: \"a\",\n      h2: \"h2\",\n      ol: \"ol\",\n      li: \"li\",\n      strong: \"strong\",\n      hr: \"hr\",\n      ul: \"ul\"\n    }, _provideComponents(), props.components);\n    return _jsxs(_Fragment, {\n      children: [_jsxs(_components.p, {\n        children: [\"이전에 \", _jsx(_components.code, {\n          children: \"good-first-issue\"\n        }), \" 이슈가 존재하는 GitHub 프로젝트 목록을 볼 수 있는 웹앱을 만드는 \", _jsx(_components.a, {\n          href: \"https://github.com/100paperkite/good-first-issue\",\n          children: \"토이프로젝트\"\n        }), \"를 진행했다.\"]\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"이 프로젝트에서는 여러가지 깃헙 정보를 가져오기 위해서 GitHub API를 사용했는데, 특히 GitHub에서 GraphQL로 제공하는 API(레포 정보를 가져오거나 이슈를 가져오는 등등)를 사용해야 했었다.\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"그런데 GitHub에서는 GraphQL로 제공하는 API는 일반 REST API와 달리 \", _jsx(_components.a, {\n          href: \"https://docs.github.com/en/graphql/guides/forming-calls-with-graphql#authenticating-with-graphql\",\n          children: \"사용자 인증\"\n        }), \"이 필요했기 때문에 웹앱에서 사용자 인증을 했어야 했고, OAuth를 사용해보게 되었다. \", _jsx(\"small\", {\n          children: \"(사실 GraphQL을 쓰지 않더라도 REST API 호출 수가 1시간에 60번인가로 너무 적었기 때문에 어찌 됐든 인증과정이 필요하긴 했다.)\"\n        })]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"OAuth?\"\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"OAuth는 인증을 위한 프로토콜로, 사용자가 다른 인터넷 서비스\", _jsx(\"small\", {\n          children: \"(여기선 GitHub)\"\n        }), \"의 기능을 다른 애플리케이션에서도 사용할 수 있게 한 것이다.\"]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"프로젝트에서 GitHub OAuth 인증 과정\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"웹앱에서 Github의 GraphQL API를 사용하려면 POST 요청의 body에 깃헙에서 발급받은 token을 포함해서 요청해야 한다.\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"그렇기 때문에 깃헙으로부터 token을 발급 받아와야 하는데, 발급 과정은 다음과 같이 이루어진다.\"\n      }), \"\\n\", _jsxs(_components.ol, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: \"사용자가 클라이언트에서 깃헙에 로그인한다.\"\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"로그인이 완료되면 깃헙이 \", _jsx(_components.code, {\n            children: \"access_token\"\n          }), \" 발급을 위한 \", _jsx(_components.code, {\n            children: \"code\"\n          }), \"를 발급해준다. (리디렉션되면서 url 파라미터에 붙어온다)\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [_jsx(_components.strong, {\n            children: \"*\"\n          }), \"클라이언트에서 \", _jsx(\"small\", {\n            children: \"(직접 올린)\"\n          }), \"프록시 서버에 \", _jsx(_components.code, {\n            children: \"code\"\n          }), \"를 보내서 토큰 발급을 요청한다.\"]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsxs(_components.p, {\n        children: [_jsx(_components.strong, {\n          children: \"*\"\n        }), \"여기서 클라이언트에서 바로 \", _jsx(_components.code, {\n          children: \"code\"\n        }), \" 로 깃헙에 \", _jsx(_components.code, {\n          children: \"access_token\"\n        }), \"을 요청하지 않고, 외부 서버를 거치는 이유는 브라우저의 \", _jsx(_components.strong, {\n          children: \"Same-Origin Policy\"\n        }), _jsx(\"small\", {\n          children: \"(보안을 위해 프로토콜, 포트, 도메인이 같은 서버로만 요청을 할 수 있게 하는 정책)\"\n        }), \"때문이다.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"이걸 해결하기 위해서는 요청을 받는 서버에서 CORS 설정을 해줘야 하지만 GitHub에서는 \", _jsx(_components.code, {\n          children: \"access_token\"\n        }), \"발급에 해당 설정을 해두진 않아서 브라우저에서 바로 요청할 수 없다.\"]\n      }), \"\\n\", _jsxs(_components.p, {\n        children: [\"code를 발급받기 위해 깃헙에 보내는 요청은, 해당 요청의 응답 헤더를 보면 깃헙에서 \", _jsx(_components.strong, {\n          children: \"access-control-allow-origin:\"\n        }), \" * 로 설정해서 내려주고 있으므로 CORS 문제가 없다.\"]\n      }), \"\\n\", _jsx(_components.hr, {}), \"\\n\", _jsxs(_components.ol, {\n        start: \"4\",\n        children: [\"\\n\", _jsxs(_components.li, {\n          children: [\"프록시 서버에서는 클라이언트의 요청을 code와 함께 받으면, \", _jsx(_components.code, {\n            children: \"client_secret\"\n          }), \" 키(깃헙에 웹앱을 등록하면 발급해준다)와 함께 GitHub에 \", _jsx(_components.code, {\n            children: \"access_token\"\n          }), \" 발급을 요청한다.\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"GitHub에서 해당 유저의 \", _jsx(_components.code, {\n            children: \"access_token\"\n          }), \" 발급이 완료되면 클라이언트에 해당 토큰을 응답으로 보낸다.\", \"\\n\", _jsxs(_components.ul, {\n            children: [\"\\n\", _jsxs(_components.li, {\n              children: [\"이 프록시 서버는 내가 직접 올린 서버이므로 CORS 설정을 해주기 때문에 클라이언트에서 \", _jsx(_components.code, {\n                children: \"CORS\"\n              }), \" 에러가 생기지 않는다.\"]\n            }), \"\\n\"]\n          }), \"\\n\"]\n        }), \"\\n\", _jsxs(_components.li, {\n          children: [\"이제 클라이언트에서는 이 토큰으로 GitHub API를 요청할 수 있다. \", _jsx(\"small\", {\n            children: \"(해당 토큰은 브라우저의 로컬 스토리지에 저장)\"\n          })]\n        }), \"\\n\"]\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"여담\"\n      }), \"\\n\", _jsx(_components.p, {\n        children: \"그런데 정리하면서 프로젝트를 확인했는데 프록시 서버가 동작하지 않아서 봤더니... 기존에 프록시 서버를 무료인 heroku로 올려놨었는데, 올해 11월 28일부터 프리 티어를 아예 없애서 프록시 서버가 꺼졌다.. 다른 프리티어 솔루션을 찾아서 다시 적용해야할 듯.\"\n      }), \"\\n\", _jsx(_components.h2, {\n        children: \"참조\"\n      }), \"\\n\", _jsxs(_components.ul, {\n        children: [\"\\n\", _jsx(_components.li, {\n          children: _jsx(_components.a, {\n            href: \"https://docs.github.com/ko/developers/apps/building-oauth-apps/authorizing-oauth-apps\",\n            children: \"깃헙 OAuth 가이드 문서\"\n          })\n        }), \"\\n\"]\n      })]\n    });\n  }\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"github-oauth"},"buildId":"b9Si3-7MjZM6Hz9lTfrhU","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>