---
title: 'Node.js ë‚´ë¶€ êµ¬ì¡°'
description: Node.js ë‚´ë¶€ êµ¬ì¡°ì— ëŒ€í•´ì„œ ì•Œì•„ë³´ê¸°
date: 2022.02.18
tags: ['node.js']
---

## Node.js?

Node.jsëŠ” JavaScriptì—”ì§„ ì¤‘ í•˜ë‚˜ì¸ Google Chrome V8ì—”ì§„ì„ ì´ìš©í•´ JavaScriptë¥¼ ë¸Œë¼ìš°ì € ë°–ì—ì„œ ì‹¤í–‰ ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ëŠ” JS Runtime Environmentì´ë‹¤.

- Node.jsëŠ” V8ì—”ì§„ì„ ì´ìš©í•´ JSë¥¼ í•´ì„í•œë‹¤.
- ë¸Œë¼ìš°ì €ì—ì„œ ëŒì•„ê°€ì§€ ì•Šê¸° ë•Œë¬¸ì— `window`ë‚˜ `document`ê°™ì€ Web APIëŠ” ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.
- OSìœ„ì—ì„œ ëŒì•„ê°€ê¸° ë•Œë¬¸ì— `fs`, `http`ê°€ standard libraryë¡œ ì œê³µëœë‹¤.
- node.jsëŠ” V8ì—”ì§„ì´ ì§€ì›í•˜ëŠ” ê¸°ëŠ¥ë§Œ ì“¸ ìˆ˜ ìˆê¸° ë•Œë¬¸ì—, ëª¨ë“  JS ê¸°ëŠ¥ì„ ë°”ë¡œ ì“°ì§€ ëª»í•  ìˆ˜ ìˆë‹¤.

#### JavaScript Engine?

JavaScript ì—”ì§„ì€ ë³€ìˆ˜, í•¨ìˆ˜ ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ” **Memory Heap**ê³¼ í•¨ìˆ˜ í˜¸ì¶œì— ì“°ì´ëŠ” **Call Stack**ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, JavaScript ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ machine ì½”ë“œë¡œ ë³€í™˜í•˜ê±°ë‚˜ Garbage Collection ë“±ë“±ì„ ìˆ˜í–‰í•œë‹¤.

ë¸Œë¼ìš°ì €ëŠ” ê°ì ë‚´ì¥ëœ JSì—”ì§„ì„ ì‚¬ìš©í•´ ì›¹ í˜ì´ì§€ì˜ JSì½”ë“œë¥¼ í•´ì„í•˜ëŠ”ë° ë¸Œë¼ìš°ì €ë§ˆë‹¤ ë‹¤ë¥¸ ì—”ì§„ì„ ì‚¬ìš©í•´ ì–¸ì–´ë¥¼ í•´ì„í•˜ê¸° ë•Œë¬¸ì— ê°™ì€ ì½”ë“œì—¬ë„ ë¸Œë¼ìš°ì €ë§ˆë‹¤ ë‹¤ë¥¸ ê²°ê³¼ê°€ ë‚˜ì˜¬ ìˆ˜ ìˆë‹¤.

## Node.js ê³„ì¸µ êµ¬ì¡°

- **Node.js API** : Node.js Applicationì— ì“°ì´ëŠ” JS API
- **Node.js Standard library** : OSê´€ë ¨ í•¨ìˆ˜ë“¤ì´ í¬í•¨ëœë‹¤(Timer `setTimeout`, File System `fs`, Network Calls `http`)
- **V8** : Memory Heap, Call Stack, Garbage Collectorë¡œ êµ¬ì„±ëœë‹¤ + JSë¥¼ OSì— ë§ëŠ” machine codeë¡œ ë³€í™˜í•œë‹¤
- **libuv** : ë¹„ë™ê¸° I/Oë¥¼ ì§€ì›í•˜ëŠ” Cì–¸ì–´ libraryë¡œ, ì»¤ë„ì˜ ë¹„ë™ê¸° API(ìœˆë„ìš°- IOCP, ë¦¬ëˆ…ìŠ¤-AIO)ë¡œ ì§€ì›í•  ìˆ˜ ì—†ëŠ” ì‘ì—…ì„ ë¹„ë™ê¸°í™” í•˜ê¸° ìœ„í•œ **ë³„ë„ì˜ Thread Pool**(ê¸°ë³¸ ê°’ìœ¼ë¡œ 4ê°œë¥¼ ì‚¬ìš©í•˜ë„ë¡ ì„¤ì •ë˜ì–´ ìˆìŒ)ì„ ê°€ì§€ê³  ìˆê³  Event Loop, Event Queueë¥¼ ê´€ë¦¬í•œë‹¤.
- **c-ares** : `dns`ëª¨ë“ˆì— ì“°ì´ëŠ” ë¹„ë™ê¸° DNS ìš”ì²­ì„ ìœ„í•œ Cì–¸ì–´ library
- **llhttp** : HTTP requeset/response íŒŒì‹± (ì´ì „ì—” `http-parsed`ê°€ ì“°ì˜€ë‹¤)
- **open-ssl** : ì•”í˜¸í™” library (`tls`, `crypto`ëª¨ë“ˆì— ì“°ì¸ë‹¤)
- **zlib** : ì••ì¶•/ì••ì¶• í•´ì œ library

> Node.js dependencies: [Dependencies | Node.js (nodejs.org)](https://nodejs.org/en/docs/meta/topics/dependencies/)

## Node.js íŠ¹ì§•

- **Single Threaded** - lockingì´ ì—†ìœ¼ë¯€ë¡œ í”„ë¡œê·¸ë¨ì´ ëœ ë³µì¡í•´ì§„ë‹¤
- **Non-Blocking I/O** - I/Oê°€ ëë‚  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¬ì§€ ì•ŠëŠ”ë‹¤
- **Asynchronous** - ë¹„ë™ê¸°ë¡œ ì‹¤í–‰í•œë‹¤

**ğŸ’¡ Single threadì„ì—ë„ Asynchronous Non-Blocking I/Oê°€ ê°€ëŠ¥í•œ ì´ìœ ëŠ” Event Loopë•Œë¬¸ì´ë‹¤.**

- Event loopì—ì„œ ê° ìš”ì²­ì— ë§ëŠ” kernelì˜ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê±°ë‚˜, kernel ë¹„ë™ê¸° í•¨ìˆ˜ë¡œ ì§€ì›ë˜ì§€ ì•ŠëŠ” ì‘ì—…ì€ libuvì˜ thread poolì„ ì´ìš©í•´ ë³„ë„ì˜ ìŠ¤ë ˆë“œë¥¼ ë§Œë“¤ì–´ ì²˜ë¦¬í•œë‹¤.
- main threadê°€ ì•„ë‹Œ ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì—¬ëŸ¬ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.

**ğŸ’¡ Multi-threadê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì— CPUë¥¼ ë§ì´ ì‚¬ìš©í•˜ëŠ” ì‘ì—…ì—ëŠ” ì í•©í•˜ì§€ ì•Šê³ , I/Oê°€ ë§ì€ ì‘ì—…ì— ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì í•©í•˜ë‹¤**

## Event Loop

<PageImage
  src="/nodejs-event-loop.png"
  alt="nodejs event loop workflow"
  sourceHref="https://www.voidcanvas.com/nodejs-event-loop/"
/>

- `node main.js`ë¥¼ ì½˜ì†”ì—ì„œ ì‹¤í–‰ì‹œì¼°ì„ ë•Œ, Node.jsëŠ” ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ìƒì„±í•œ ë‹¤ìŒ **ì´ë²¤íŠ¸ ë£¨í”„ ë°”ê¹¥**ì—ì„œ ë©”ì¸ ëª¨ë“ˆì¸ `main.js`ë¥¼ ì‹¤í–‰í•œë‹¤.
- í•œë²ˆ ë©”ì¸ ëª¨ë“ˆì´ ì‹¤í–‰ë˜ê³ ë‚˜ë©´ Node.jsëŠ” ì´ë²¤íŠ¸ ë£¨í”„ê°€ í™œì„± ìƒíƒœì¸ì§€, ì¦‰ ì´ë²¤íŠ¸ ë£¨í”„ ì•ˆì—ì„œ í•´ì•¼í•  ì‘ì—…ì´ ìˆëŠ”ì§€ë¥¼ í™•ì¸í•œë‹¤. ë§Œì•½ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ëŒë¦´ í•„ìš”ê°€ ì—†ë‹¤ë©´ ì¢…ë£Œí•œë‹¤.
- ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ëŒë ¤ì•¼ í•œë‹¤ë©´ Timer ë‹¨ê³„ë¶€í„° ì‹¤í–‰ëœë‹¤.
- ìœ¡ê°í˜•ì´ ì´ë²¤íŠ¸ ë£¨í”„ì˜ ê° ë‹¨ê³„ë¥¼ ë§í•˜ê³ , ê° ë‹¨ê³„ëŠ” ì‹¤í–‰í•  callbackë“¤ì„ ë‹´ì€ FIFO Queueë¥¼ ê°€ì§„ë‹¤

  - ë‚´ë¶€ì˜ `nextTickQueue`, `microTaskQueue` ëŠ” ì´ë²¤íŠ¸ ë£¨í”„ì˜ ì¼ë¶€ê°€ ì•„ë‹ˆë©° ì–´ë–¤ ë‹¨ê³„ì—ì„œë“  ì‹¤í–‰ë  ìˆ˜ ìˆê³ , ê°€ì¥ ë†’ì€ ìš°ì„ ìˆœìœ„ë¥¼ ì§€ë‹Œë‹¤.
  - `nextTickQueue`ì— ë‹´ê¸´ ì‘ì—…ì´ ì¬ê·€ í˜¸ì¶œì„ ìˆ˜í–‰í•˜ëŠ” ê²½ìš° Node.jsì˜ ì‘ì—… í”„ë¡œì„¸ìŠ¤ë¥¼ ë¸”ë¡í‚¹í•  ìˆ˜ ìˆë‹¤.

- ì´ë²¤íŠ¸ ë£¨í”„ê°€ í•´ë‹¹ ë‹¨ê³„ì— ì§„ì…í•˜ë©´ í•´ë‹¹ ë‹¨ê³„ì— í•œì •ëœ ì‘ì—…ì„ ìˆ˜í–‰í•˜ê³ , íë¥¼ ëª¨ë‘ ì†Œì§„í•˜ê±°ë‚˜ ìµœëŒ€ ê°œìˆ˜ì˜ ì½œë°±ì„ ì‹¤í–‰í• ë•Œ ê¹Œì§€ ì½œë°±ì„ ì‹¤í–‰í•œë‹¤. (íë¥¼ ëª¨ë‘ ì†Œì§„í•˜ê±°ë‚˜ ì½œë°± ì œí•œì— ê±¸ë¦¬ë©´ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™)
- Call Stackì´ ë¹„ì–´ìˆìœ¼ë©´ ì´ë²¤íŠ¸ ë£¨í”„ëŠ” íì—ì„œ I/Oê°€ ëë‚œ ì‘ì—…ì˜ ì½œë°±ì„ Call Stackì— ë„˜ê²¨ì„œ ì‹¤í–‰ë  ìˆ˜ ìˆê²Œ í•œë‹¤.
- ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ë£¨í”„ë§ˆë‹¤ ë‹¤ë¥¸ ë¹„ë™ê¸° I/Oë‚˜ Timerë¥¼ ê¸°ë‹¤ë ¤ì•¼ í•˜ëŠ”ì§€ í™•ì¸í•˜ê³  ê¸°ë‹¤ë¦¬ëŠ” ê²ƒì´ ì—†ë‹¤ë©´ ê¹”ë”í•˜ê²Œ ì¢…ë£Œí•œë‹¤.

### ê° ë‹¨ê³„

#### **timers**

`setTimeout()`ê³¼ `setInterval()`ë¡œ ìŠ¤ì¼€ì¤„ë§í•œ ì½œë°±ì„ ì‹¤í–‰í•œë‹¤. (min-heapìœ¼ë¡œ íƒ€ì´ë¨¸ë“¤ì„ ìœ ì§€í•œë‹¤)

íƒ€ì´ë¨¸ ì½œë°±ì€ ì§€ì •í•œ ì‹œê°„ì´ ì§€ë‚œ í›„ì— ìŠ¤ì¼€ì¤„ë§ ë  ìˆ˜ ìˆëŠ” ê°€ì¥ ì´ë¥¸ì‹œê°„ì— ì‹¤í–‰ëœë‹¤. (ìš´ì˜ì²´ì œ ìŠ¤ì¼€ì¤„ë§ì´ë‚˜ ë‹¤ë¥¸ ì½œë°± ì‹¤í–‰ë•Œë¬¸ì— ì§€ì—°ë  ìˆ˜ ìˆë‹¤)

\*ê¸°ìˆ ì ìœ¼ë¡œëŠ” poll ë‹¨ê³„ì—ì„œ íƒ€ì´ë¨¸ë¥¼ ì–¸ì œ ì‹¤í–‰í• ì§€ ì œì–´í•œë‹¤. (poll íì— ì´ë²¤íŠ¸ê°€ ì—†ì–´ì•¼ Timerë¥¼ í™•ì¸í•œë‹¤)

#### **pending callbacks**

TCP ì˜¤ë¥˜ ê°™ì€ ì‹œìŠ¤í…œ ì‘ì—…ì˜ ì½œë°±ì„ ì‹¤í–‰í•œë‹¤.

ex. ì—ëŸ¬ í•¸ë“¤ëŸ¬ ì½œë°±

#### **idle, prepare**

ë‚´ë¶€ìš©ìœ¼ë¡œë§Œ ì‚¬ìš©í•œë‹¤.

#### **poll**

##### **ë‘ ê°€ì§€ ì£¼ìš” ê¸°ëŠ¥**

- I/Oë¥¼ ì–¼ë§ˆë‚˜ ì˜¤ë˜ blockí•˜ê³  pollingí•˜ëŠ” ì§€ ê³„ì‚°í•œë‹¤
- ê·¸ ë‹¤ìŒ poll íì— ìˆëŠ” ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•œë‹¤
  - I/Oì™€ ì—°ê´€ëœ ì½œë°±(close callback, Timer callback, `setImmediate()`ë¥¼ ì œì™¸í•œ ê±°ì˜ ëª¨ë“  ì½œë°±ì´ í¬í•¨ëœë‹¤)

ë§Œì•½ ì´ë²¤íŠ¸ ë£¨í”„ê°€ ì´ ë‹¨ê³„ì— ì§„ì…í•˜ê³ , **ìŠ¤ì¼€ì¤„ë§ëœ íƒ€ì´ë¨¸ê°€ ì—†ì„ë•Œ** ë‘ ê°€ì§€ ìƒí™© ì¤‘ í•˜ë‚˜ê°€ ë°œìƒí•œë‹¤.

- Poll íê°€ **ë¹„ì–´ìˆì§€ ì•Šë‹¤ë©´** ì´ë²¤íŠ¸ ë£¨í”„ê°€ ì½œë°±ì˜ íë¥¼ ìˆœíšŒí•˜ë©´ì„œ íë¥¼ ë‹¤ ì†Œì§„í•˜ê±°ë‚˜, ì‹œìŠ¤í…œì— ì˜ì¡´ì ì¸ í•˜ë“œ í•œê³„ì— ë„ë‹¬í•  ë•Œê¹Œì§€ ë™ê¸°ë¡œ ì½œë°±ì„ ì‹¤í–‰í•œë‹¤.
- Poll íê°€ **ë¹„ì–´ìˆë‹¤ë©´** ë‹¤ìŒ ì¤‘ í•˜ë‚˜ì˜ ìƒí™©ì´ ë°œìƒí•œë‹¤.
  - setImmediate()ê°€ ìŠ¤ì¼€ì¤„ë§ë˜ì—ˆë‹¤ë©´ ì´ë²¤íŠ¸ ë£¨í”„ëŠ” pollë‹¨ê³„ë¥¼ ì¢…ë£Œí•˜ê³  ìŠ¤ì¼€ì¤„ë§ëœ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ checkë‹¨ê³„ë¡œ ë„˜ì–´ê°„ë‹¤
  - setImmediate()ê°€ ìŠ¤ì¼€ì¤„ë§ë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì´ë²¤íŠ¸ ë£¨í”„ëŠ” ì½œë°±ì´ Poll íì— ì¶”ê°€ë˜ê¸°ë¥¼ ê¸°ë‹¤ë¦° í›„ ì¦‰ì‹œ ì‹¤í–‰í•œë‹¤

+) ë‹¨, poll íê°€ ì¼ë‹¨ ë¹„ê²Œ ë˜ë©´ íƒ€ì´ë¨¸ê°€ **ì‹œê°„ì„ ì´ˆê³¼í–ˆëŠ”ì§€** í™•ì¸í•˜ê³ , í•˜ë‚˜ ì´ìƒì˜ íƒ€ì´ë¨¸ê°€ ì¤€ë¹„ë˜ì—ˆë‹¤ë©´ ì´ë²¤íŠ¸ ë£¨í”„ëŠ” íƒ€ì´ë¨¸ì˜ ì½œë°±ì„ ì‹¤í–‰í•˜ê¸° ìœ„í•´ timersë‹¨ê³„ë¡œ ëŒì•„ê°„ë‹¤.

+) í´ë§ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ë©´ì„œ poll ì´ë²¤íŠ¸ë¥¼ íì— ì¶”ê°€í•  ìˆ˜ ìˆë‹¤. ê·¸ ê²°ê³¼ ì˜¤ë˜ ì‹¤í–‰ë˜ëŠ” ì½œë°±ì€ poll ë‹¨ê³„ê°€ íƒ€ì´ë¨¸ì˜ í•œê³„ ì‹œì ë³´ë‹¤ í›¨ì”¬ ë” ì˜¤ë˜ ì‹¤í–‰ë˜ë„ë¡ í•  ìˆ˜ ìˆë‹¤. (ë‹¨, poll ë‹¨ê³„ê°€ ì´ë²¤íŠ¸ ë£¨í”„ë¥¼ ëª¨ë‘ ì°¨ì§€í•˜ë©´ ì•ˆë˜ë¯€ë¡œ libuvëŠ” ìµœëŒ€ì¹˜ë¥¼ ì„¤ì •í•œë‹¤)

#### **check**

`setImmediate()` ì½œë°±ì„ í˜¸ì¶œí•œë‹¤.

#### **close callbacks**

`socket.on('close', ...)`ê°™ì€ close ì´ë²¤íŠ¸ íƒ€ì…ì˜ í•¸ë“¤ëŸ¬ë“¤ì„ ì²˜ë¦¬í•œë‹¤.

### setImmediate() vs setTimeout() vs process.nextTick() ì‹¤í–‰ ìˆœì„œ

#### setImmediate() vs setTimeout()

ë¹„ìŠ·í•˜ì§€ë§Œ í˜¸ì¶œëœ ì‹œê¸°ì— ë”°ë¼ ë‹¤ë¥´ê²Œ ë™ì‘í•œë‹¤.

**Example 1**

```javascript
setTimeout(() => {
  console.log('setTimeout');
}, 0);
setImmediate(() => {
  console.log('setImmediate');
});
```

â–² ë­ê°€ ë¨¼ì € ì¶œë ¥ë˜ëŠ” ì§€ ì•Œ ìˆ˜ ì—†ë‹¤. ì´ë²¤íŠ¸ ë£¨í”„ê°€ Timer ë‹¨ê³„ì— ì§„ì…í•  ë•Œ íƒ€ì´ë¨¸ê°€ ë“±ë¡ë˜ì§€ ì•Šì„ ìˆ˜ ìˆê¸° ë•Œë¬¸ì´ë‹¤(íƒ€ì´ë¨¸ëŠ” ë©”ëª¨ë¦¬ì— ì €ì¥ë˜ëŠ”ë°, ê·¸ ìˆœê°„ ì»´í“¨í„°ì˜ ì„±ëŠ¥ì´ë‚˜ Node.jsê°€ ì•„ë‹Œ ì™¸ë¶€ ì‘ì—… ë•Œë¬¸ì— ì•½ê°„ì˜ ë”œë ˆì´ê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤)

**Example 2**

```javascript
fs.readFile('my-file-path.txt', () => {
  setTimeout(() => {
    console.log('setTimeout');
  }, 0);
  setImmediate(() => {
    console.log('setImmediate');
  });
});
```

â–² I/O ì£¼ê¸° ë‚´ì—ì„œ í˜¸ì¶œí•˜ë©´ `setImmediate`ê°€ í•­ìƒ ë¨¼ì € ì‹¤í–‰ëœë‹¤. (poll ì´í›„ì— ë°”ë¡œ checkë‹¨ê³„ì—ì„œ setImmediateê°€ ì‹¤í–‰ë˜ë¯€ë¡œ. setTimeoutì€ ê·¸ ë‹¤ìŒ ë£¨í”„ì˜ timersì—ì„œ ì‹¤í–‰ëœë‹¤)

#### setImmediate() vs process.nextTick()

process.nextTick()ì´ setImmediate()ë³´ë‹¤ ë” ì¦‰ì‹œ ì‹¤í–‰ëœë‹¤.

- process.nextTick(): í•œ ë‹¨ê³„ì—ì„œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ë„˜ì–´ê°€ëŠ” ë§¤ `tick`ë§ˆë‹¤ ìµœëŒ€í•œ ë¹¨ë¦¬ í˜¸ì¶œë˜ë„ë¡ ì‘ë™ëœë‹¤.
- setImmediate(): ë£¨í”„ê°€ ëŒë•Œë§ˆë‹¤ ê´€ë¦¬í•œë‹¤.

## ì°¸ê³  ìë£Œ

- [Node.js ì´ë²¤íŠ¸ ë£¨í”„, íƒ€ì´ë¨¸, \`process.nextTick()\` | Node.js (nodejs.org)](https://nodejs.org/ko/docs/guides/event-loop-timers-and-nexttick/)
- [Node.js event loop workflow & lifecycle in low level (voidcanvas.com)](https://www.voidcanvas.com/nodejs-event-loop/)
- [NodeJS Event LoopíŒŒí—¤ì¹˜ê¸°](https://medium.com/zigbang/nodejs-event-loop%ED%8C%8C%ED%97%A4%EC%B9%98%EA%B8%B0-16e9290f2b30)
- [NodeJS Architecture & Concurrency Model | by Udara Bibile | Medium](https://chathuranga94.medium.com/nodejs-architecture-concurrency-model-f71da5f53d1d)
- [ë¡œìš° ë ˆë²¨ë¡œ ì‚´í´ë³´ëŠ” Node.js ì´ë²¤íŠ¸ ë£¨í”„ | Evans Library (evan-moon.github.io)](https://evan-moon.github.io/2019/08/01/nodejs-event-loop-workflow/)
